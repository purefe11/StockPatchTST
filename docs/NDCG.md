# 🍭 NDCG 쉽게 이해하기 – 사탕 랭킹 게임으로 배우는 주식 모델 평가
> NDCG(Normalized Discounted Cumulative Gain)
> 
> 추천/랭킹 시스템에서 상위에 중요한 아이템이 잘 배치되었는지를 평가하며,  
> 높은 점수를 가진 아이템이 상위에 올수록 높은 점수를 부여한다.  
> 반대로, 순위가 낮을수록 중요도가 할인되어 더 낮은 점수를 받는다.

---

## 🧒 사탕 랭킹 게임

"내가 좋아하는 사탕 TOP 5"를 맞히는 게임

| 순위 | 사탕 이름 | 좋아하는 정도 |
|------|-----------|----------------|
| 1등 | 🍓 딸기사탕 | 3점 (엄청 좋아함) |
| 2등 | 🍫 초코사탕 | 2점 (좋아함) |
| 3등 | 🍋 레몬사탕 | 1점 (그럭저럭) |
| 4등 | 🍇 포도사탕 | 0점 (싫어요) |
| 5등 | 🍬 민트사탕 | 0점 (진짜 싫어요) |

친구의 예측 순서:
```
① 🍫 → ② 🍓 → ③ 🍇 → ④ 🍬 → ⑤ 🍋
```

---

## 📊 점수 계산 (DCG)

### 🔹 DCG: Discounted Cumulative Gain  
**순위에 따라 점수를 감산하여 누적 합산하는 방식**

![dcg_formula](https://latex.codecogs.com/png.image?\fg{gray}\dpi{100}&space;\text{DCG}_p=\sum_{i=1}^{p}\frac{2^{\text{rel}_i}-1}{\log_2(i+1)})
> 2진로그를 사용하여 등수에 따라 점수를 완만하게 감소시킨다.

| 예측 순위 | 사탕 | 좋아하는 정도 | 계산 |
|-----------|------|----------------|--------|
| 1등       | 🍫   | 2              | (2^2 - 1)/log₂(2) = 3.0 |
| 2등       | 🍓   | 3              | (2^3 - 1)/log₂(3) ≈ 4.42 |
| 3등       | 🍇   | 0              | 0 |
| 4등       | 🍬   | 0              | 0 |
| 5등       | 🍋   | 1              | (2^1 - 1)/log₂(6) ≈ 0.39 |

**DCG = 3.0 + 4.42 + 0 + 0 + 0.39 = 약 7.81**

---

## 🥇 최고 점수 (IDCG)

### 🔹 IDCG: Ideal DCG  
**관련성 점수가 높은 순서대로 완벽히 정렬했을 때의 DCG**

![idcg_formula](https://latex.codecogs.com/png.image?\fg{gray}\dpi{100}&space;\text{IDCG}_p=\text{DCG&space;of&space;ideal&space;ranking})

| 순위 | 사탕 | 좋아하는 정도 | 계산 |
|------|------|----------------|--------|
| 1등  | 🍓(3) | (2^3 - 1)/log₂(2) = 7.0 |
| 2등  | 🍫(2) | (2^2 - 1)/log₂(3) ≈ 1.89 |
| 3등  | 🍋(1) | (2^1 - 1)/log₂(4) = 1 / 2 = 0.5 |

**IDCG = 7.0 + 1.89 + 0.5 = 약 9.39**

---

## ✅ NDCG 계산

### 🔹 NDCG: Normalized DCG  
**DCG를 IDCG로 나눈 정규화 점수로, 0~1 사이의 값을 가진다.**

![ndcg_formula](https://latex.codecogs.com/png.image?\fg{gray}\dpi{100}&space;\text{NDCG}_p=\frac{\text{DCG}_p}{\text{IDCG}_p})

NDCG = 7.81 / 9.39 ≈ 0.831

---

## 🔁 주식 랭킹 모델에 비유하면?

| 사탕 예시 | 주식 예시 |
|-----------|-----------|
| "좋아하는 정도" 점수 | **5일 후 수익률 분위수 등급 (0~4)** |
| 친구가 맞춘 순서     | **모델이 예측한 주식 순위** |
| 점수 계산 방법 (NDCG) | **예측 순위와 실제 수익률이 얼마나 잘 맞았는지 평가** |

---

## 🧠 예시로 다시 보기

| 종목 | 실제 수익률 | 분위 라벨 | 모델 예측 순위 |
|------|--------------|------------|----------------|
| A    | +12%         | 4 (최상)   | 1등             |
| B    | +3%          | 3          | 2등             |
| C    | 0%           | 2          | 3등             |
| D    | -1%          | 1          | 4등             |
| E    | -5%          | 0 (최하)   | 5등             |

→ 모델이 완벽하게 예측했다면 **NDCG = 1.0 (100점!)**

---

## 🧁 요약 정리

- **NDCG는 예측된 순위와 실제 관련성(또는 수익률 등급)이 얼마나 일치하는지 나타내는 지표이다.**
- 수익률이 높은 종목을 더 위쪽에 잘 배치할수록 NDCG 점수는 높아진다.
- **랭킹 기반 주식 모델**에서 성능 평가 지표로 매우 유용하게 사용된다.
